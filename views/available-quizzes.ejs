<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Available Quizzes - SkillOns</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* Quiz Tabs Styles */
        .quiz-tabs {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 0 20px;
        }

        .tab-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px 25px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            background: white;
            color: #6b7280;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .tab-btn:hover {
            border-color: #667eea;
            color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        }

        .tab-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
        }

        /* Pagination Styles */
        .pagination-container {
            margin-top: 40px;
            padding: 25px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .pagination-info {
            margin-bottom: 20px;
            color: #6b7280;
            font-size: 14px;
        }

        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .page-indicator {
            background: #f3f4f6;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            min-width: 120px;
        }

        .btn-outline-primary {
            background: transparent;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .btn-outline-primary:hover:not(.disabled) {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .btn-outline-primary.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .quiz-tabs {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }

            .tab-btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }

            .pagination-controls {
                flex-direction: column;
                gap: 15px;
            }

            .page-indicator {
                order: -1;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="/">SkillOns</a>
            </div>
            <div class="nav-menu">
                <a href="/student/dashboard" class="nav-link">Dashboard</a>
                <a href="/available-quizzes" class="nav-link active">Available Quizzes</a>
                <a href="/student/study-material" class="nav-link">View Study Material</a>
                <a href="/my-results" class="nav-link">My Results</a>
                <a href="#" class="nav-link" onclick="openStudentProfile()">Student Grade Level</a>
                <a href="/select-role" class="nav-link">Change Role</a>
                <a href="/logout" class="nav-link logout-btn">Logout</a>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="quizzes-container">
            <div class="quizzes-header">
                <h1><i class="fas fa-file-alt me-2"></i>Browse Quizzes</h1>
                <p>Choose a quiz to test your knowledge and track your progress</p>
            </div>

            <!-- Quiz Tabs -->
            <div class="quiz-tabs">
                <button class="tab-btn <%= currentTab === 'available' ? 'active' : '' %>" onclick="switchTab('available')">
                    <i class="fas fa-play-circle"></i>
                    Available Quizzes
                    <span class="tab-count">(<%= counts.available %>)</span>
                </button>
                <button class="tab-btn <%= currentTab === 'archived' ? 'active' : '' %>" onclick="switchTab('archived')">
                    <i class="fas fa-archive"></i>
                    Archived Quizzes
                    <span class="tab-count">(<%= counts.archived %>)</span>
                </button>
            </div>

            <% if (quizzes.length > 0) { %>
                <div class="quizzes-grid">
                    <% quizzes.forEach(quiz => { %>
                        <div class="quiz-card">
                            <div class="quiz-card-header">
                                <div class="quiz-icon">
                                    <i class="fas <%= quiz.quizType === 'competitive' ? 'fa-trophy' : 'fa-file-alt' %>"></i>
                                </div>
                                <div class="quiz-status approved">
                                    <i class="fas fa-check-circle"></i>
                                    Approved
                                </div>
                            </div>
                            
                            <div class="quiz-card-content">
                                <h3>
                                    <%= quiz.title %>
                                    <% if (quiz.quizType === 'competitive') { %>
                                        <span class="badge bg-warning text-dark" style="font-size: 11px; margin-left: 8px;">
                                            <i class="fas fa-trophy"></i> Competitive
                                        </span>
                                    <% } %>
                                </h3>
                                <p class="quiz-description"><%= quiz.description %></p>
                                
                                <div class="quiz-meta">
                                    <div class="meta-item">
                                        <i class="fas fa-question-circle"></i>
                                        <span><%= quiz.questions.length %> Questions</span>
                                    </div>
                                    <div class="meta-item">
                                        <i class="fas fa-clock"></i>
                                        <span><%= Math.ceil(quiz.questions.length * 1.5) %> min</span>
                                    </div>
                                    <div class="meta-item">
                                        <i class="fas fa-star"></i>
                                        <span><%= quiz.questions.reduce((sum, q) => sum + q.points, 0) %> Points</span>
                                    </div>
                                    <div class="meta-item">
                                        <i class="fas fa-graduation-cap"></i>
                                        <span><%= quiz.gradeLevel %></span>
                                    </div>
                                    <div class="meta-item">
                                        <i class="fas fa-book"></i>
                                        <span><%= quiz.subjects.join(', ') %></span>
                                    </div>
                                    <% if (quiz.organizationName) { %>
                                    <div class="meta-item">
                                        <i class="fas fa-school"></i>
                                        <span><%= quiz.organizationName %></span>
                                    </div>
                                    <% } %>
                                    <% if (quiz.isTaken && quiz.previousScore !== null) { %>
                                        <div class="meta-item previous-score">
                                            <i class="fas fa-trophy"></i>
                                            <span>Previous: <%= quiz.previousScore %>%</span>
                                        </div>
                                    <% } %>
                                    <% if (quiz.isTaken) { %>
                                        <div class="meta-item attempt-count">
                                            <i class="fas fa-repeat"></i>
                                            <span>Attempts: <%= quiz.attemptCount %>/3</span>
                                        </div>
                                    <% } %>
                                </div>
                                
                                <div class="quiz-author">
                                    <i class="fas fa-user"></i>
                                    <span>By: <%= quiz.createdByName %></span>
                                </div>
                            </div>
                            
                            <div class="quiz-card-actions">
                                <% if (quiz.isTaken) { %>
                                    <% if (quiz.canRetake) { %>
                                        <a href="/take-quiz/<%= quiz._id %>" class="btn btn-secondary">
                                            <i class="fas fa-redo"></i> Retake Quiz (<%= 3 - quiz.attemptCount %> left)
                                        </a>
                                    <% } else { %>
                                        <button class="btn btn-disabled" disabled>
                                            <i class="fas fa-ban"></i> Max Attempts Reached
                                        </button>
                                    <% } %>
                                <% } else { %>
                                    <a href="/take-quiz/<%= quiz._id %>" class="btn btn-primary">
                                        <i class="fas fa-play"></i> Start Quiz
                                    </a>
                                <% } %>
                            </div>
                        </div>
                    <% }); %>
                </div>

                <!-- Pagination Controls -->
                <% if (pagination.totalPages > 1) { %>
                    <div class="pagination-container">
                        <div class="pagination-info">
                            <span>Showing <%= ((pagination.currentPage - 1) * pagination.limit) + 1 %>-<%= Math.min(pagination.currentPage * pagination.limit, pagination.totalQuizzes) %> of <%= pagination.totalQuizzes %> quizzes</span>
                        </div>
                        <div class="pagination-controls">
                            <a href="?tab=<%= currentTab %>&page=<%= pagination.prevPage %>" class="btn btn-sm btn-outline-primary <%= !pagination.hasPrevPage ? 'disabled' : '' %>" <%= !pagination.hasPrevPage ? 'onclick="return false;"' : '' %>>
                                <i class="fas fa-chevron-left"></i> Previous
                            </a>
                            <span class="page-indicator">
                                Page <span><%= pagination.currentPage %></span> of <span><%= pagination.totalPages %></span>
                            </span>
                            <a href="?tab=<%= currentTab %>&page=<%= pagination.nextPage %>" class="btn btn-sm btn-outline-primary <%= !pagination.hasNextPage ? 'disabled' : '' %>" <%= !pagination.hasNextPage ? 'onclick="return false;"' : '' %>>
                                Next <i class="fas fa-chevron-right"></i>
                            </a>
                        </div>
                    </div>
                <% } %>
            <% } else { %>
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-<%= currentTab === 'archived' ? 'archive' : 'file-alt' %>"></i>
                    </div>
                    <h3><%= currentTab === 'archived' ? 'No Archived Quizzes' : 'No Quizzes Available' %></h3>
                    <% if (currentTab === 'archived') { %>
                        <p>You haven't completed any quizzes yet. Start by taking some available quizzes!</p>
                        <a href="?tab=available" class="btn btn-primary">
                            <i class="fas fa-play"></i> Browse Available Quizzes
                        </a>
                    <% } else { %>
                        <p>No quizzes found for your grade level (<%= user.gradeLevel || 'Not Set' %>) and subjects (<%= (user.subjects || []).join(', ') || 'Not Set' %>).</p>
                        <p>Please update your profile or check back later for new quizzes!</p>
                        <div class="empty-state-actions">
                            <button class="btn btn-primary" onclick="openStudentProfile()">
                                <i class="fas fa-user-edit"></i> Update Profile
                            </button>
                        </div>
                    <% } %>
                </div>
            <% } %>
        </div>
    </main>

    <!-- Student Profile Modal -->
    <div id="studentProfileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-graduate me-2"></i>Student Profile</h2>
                <span class="close" onclick="closeStudentProfile()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="studentProfileForm">
                    <div class="form-group">
                        <label for="gradeLevel">Grade Level:</label>
                        <select id="gradeLevel" name="gradeLevel" required>
                            <option value="">Select Grade Level</option>
                            <option value="1st grade">1st Grade</option>
                            <option value="2nd grade">2nd Grade</option>
                            <option value="3rd grade">3rd Grade</option>
                            <option value="4th grade">4th Grade</option>
                            <option value="5th grade">5th Grade</option>
                            <option value="6th grade">6th Grade</option>
                            <option value="7th grade">7th Grade</option>
                            <option value="8th grade">8th Grade</option>
                            <option value="9th grade">9th Grade</option>
                            <option value="10th grade">10th Grade</option>
                            <option value="11th grade">11th Grade</option>
                            <option value="12th grade">12th Grade</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Subjects:</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="subjectEnglish" name="subjects" value="English">
                                <label for="subjectEnglish">English</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="subjectScience" name="subjects" value="Science">
                                <label for="subjectScience">Science</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="subjectMath" name="subjects" value="Math">
                                <label for="subjectMath">Math</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Save Profile</button>
                        <button type="button" class="btn btn-secondary" onclick="closeStudentProfile()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2025 SkillOns. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Function to switch between Available and Archived quiz tabs
        function switchTab(tab) {
            // Update URL with new tab and reset to first page
            const url = new URL(window.location);
            url.searchParams.set('tab', tab);
            url.searchParams.set('page', '1');
            window.location.href = url.toString();
        }

        // Student Profile Modal Functions
        function openStudentProfile() {
            const modal = document.getElementById('studentProfileModal');
            modal.style.display = 'block';
            modal.classList.add('show');
            loadStudentProfile();
        }
        
        function closeStudentProfile() {
            const modal = document.getElementById('studentProfileModal');
            modal.style.display = 'none';
            modal.classList.remove('show');
        }
        
        function loadStudentProfile() {
            fetch('/student-profile')
                .then(response => response.json())
                .then(data => {
                    // Set grade level
                    const gradeSelect = document.getElementById('gradeLevel');
                    gradeSelect.value = data.gradeLevel || '';
                    
                    // Set subjects
                    const subjectCheckboxes = document.querySelectorAll('input[name="subjects"]');
                    subjectCheckboxes.forEach(checkbox => {
                        checkbox.checked = data.subjects.includes(checkbox.value);
                    });
                })
                .catch(error => {
                    console.error('Error loading student profile:', error);
                });
        }
        
        // Handle form submission
        document.getElementById('studentProfileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const gradeLevel = document.getElementById('gradeLevel').value;
            const subjectCheckboxes = document.querySelectorAll('input[name="subjects"]:checked');
            const subjects = Array.from(subjectCheckboxes).map(cb => cb.value);
            
            fetch('/update-student-profile', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    gradeLevel: gradeLevel,
                    subjects: subjects
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Profile updated successfully!', 'success');
                    closeStudentProfile();
                    // Reload page to reflect changes
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else {
                    showNotification('Error updating profile: ' + data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error updating profile:', error);
                showNotification('Error updating profile', 'error');
            });
        });
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('studentProfileModal');
            if (event.target === modal) {
                closeStudentProfile();
            }
        }
        
        // Ensure profile modal is hidden on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Available quizzes page loaded');
            
            // Explicitly ensure modal is hidden on page load
            const modal = document.getElementById('studentProfileModal');
            if (modal) {
                modal.style.display = 'none';
                modal.classList.remove('show');
                console.log('Profile modal explicitly hidden on page load');
            }
        });
        
        // Notification function
        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            
            // Add to page
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html> 