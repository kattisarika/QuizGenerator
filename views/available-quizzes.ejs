<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Available Quizzes - Take Quiz Now!</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="/">Take Quiz Now!</a>
            </div>
            <div class="nav-menu">
                <a href="/student/dashboard" class="nav-link">Dashboard</a>
                <a href="/available-quizzes" class="nav-link active">Available Quizzes</a>
                <a href="/student/study-material" class="nav-link">View Study Material</a>
                <a href="/my-results" class="nav-link">My Results</a>
                <a href="/student/dashboard" class="nav-link">Student Grade Level</a>
                <a href="/select-role" class="nav-link">Change Role</a>
                <a href="/logout" class="nav-link logout-btn">Logout</a>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="quizzes-container">
            <div class="quizzes-header">
                <h1><i class="fas fa-file-alt me-2"></i>Available Quizzes</h1>
                <p>Choose a quiz to test your knowledge and track your progress</p>
            </div>

            <% if (quizzes.length > 0) { %>
                <div class="quizzes-grid">
                    <% quizzes.forEach(quiz => { %>
                        <div class="quiz-card">
                            <div class="quiz-card-header">
                                <div class="quiz-icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <div class="quiz-status approved">
                                    <i class="fas fa-check-circle"></i>
                                    Approved
                                </div>
                            </div>
                            
                            <div class="quiz-card-content">
                                <h3><%= quiz.title %></h3>
                                <p class="quiz-description"><%= quiz.description %></p>
                                
                                <div class="quiz-meta">
                                    <div class="meta-item">
                                        <i class="fas fa-question-circle"></i>
                                        <span><%= quiz.questions.length %> Questions</span>
                                    </div>
                                    <div class="meta-item">
                                        <i class="fas fa-clock"></i>
                                        <span><%= Math.ceil(quiz.questions.length * 1.5) %> min</span>
                                    </div>
                                    <div class="meta-item">
                                        <i class="fas fa-star"></i>
                                        <span><%= quiz.questions.reduce((sum, q) => sum + q.points, 0) %> Points</span>
                                    </div>
                                    <div class="meta-item">
                                        <i class="fas fa-graduation-cap"></i>
                                        <span><%= quiz.gradeLevel %></span>
                                    </div>
                                    <div class="meta-item">
                                        <i class="fas fa-book"></i>
                                        <span><%= quiz.subjects.join(', ') %></span>
                                    </div>
                                    <% if (quiz.isTaken && quiz.previousScore !== null) { %>
                                        <div class="meta-item previous-score">
                                            <i class="fas fa-trophy"></i>
                                            <span>Previous: <%= quiz.previousScore %>%</span>
                                        </div>
                                    <% } %>
                                    <% if (quiz.isTaken) { %>
                                        <div class="meta-item attempt-count">
                                            <i class="fas fa-repeat"></i>
                                            <span>Attempts: <%= quiz.attemptCount %>/3</span>
                                        </div>
                                    <% } %>
                                </div>
                                
                                <div class="quiz-author">
                                    <i class="fas fa-user"></i>
                                    <span>By: <%= quiz.createdByName %></span>
                                </div>
                            </div>
                            
                            <div class="quiz-card-actions">
                                <% if (quiz.isTaken) { %>
                                    <% if (quiz.canRetake) { %>
                                        <a href="/take-quiz/<%= quiz._id %>" class="btn btn-secondary">
                                            <i class="fas fa-redo"></i> Retake Quiz (<%= 3 - quiz.attemptCount %> left)
                                        </a>
                                    <% } else { %>
                                        <button class="btn btn-disabled" disabled>
                                            <i class="fas fa-ban"></i> Max Attempts Reached
                                        </button>
                                    <% } %>
                                <% } else { %>
                                    <a href="/take-quiz/<%= quiz._id %>" class="btn btn-primary">
                                        <i class="fas fa-play"></i> Start Quiz
                                    </a>
                                <% } %>
                            </div>
                        </div>
                    <% }); %>
                </div>
            <% } else { %>
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <h3>No Quizzes Available</h3>
                    <p>No quizzes found for your grade level (<%= user.gradeLevel || 'Not Set' %>) and subjects (<%= (user.subjects || []).join(', ') || 'Not Set' %>).</p>
                    <p>Please update your profile from the dashboard or check back later for new quizzes!</p>
                    <div class="empty-state-actions">
                        <a href="/student/dashboard" class="btn btn-primary">
                            <i class="fas fa-arrow-left"></i> Back to Dashboard
                        </a>
                    </div>
                </div>
            <% } %>
        </div>
    </main>



    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2024 Take Quiz Now!. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Debug: Check page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Available quizzes page loaded');
            console.log('User grade level:', '<%= user.gradeLevel || "Not Set" %>');
            console.log('User subjects:', '<%= (user.subjects || []).join(", ") || "Not Set" %>');
            console.log('Number of quizzes:', <%= quizzes.length %>);
        });
    </script>
</body>
</html> 